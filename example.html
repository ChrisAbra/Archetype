<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Archetype testing</title>
	<link href="style.css" rel="stylesheet" type="text/css" />
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g="
	    crossorigin="anonymous"></script>
	<script src="data.js"></script>
	<script src="main.js"></script>
	<script src="deepDiff.js"></script>


</head>

<body>
	<div>
		<div arc-container="apps" arc-list="applicationData" id="inbox-items">
			<div arc-object="arc-var" arc-id="id" class="stack inbox-item">
				<span arc-out="studentName">Student Name</span>
				<span arc-out="studentCode">Stucode</span>
				<div class="pdfIDContainer" arc-object="pdfIds">
					<span arc-out="one"> pdfID1</span> test content not <b>defined</b>
					<b arc-out="two"> pdfID2</b>
					<u arc-out="three"> pdfID3</u>
				</div>
				<div class="listContainer" arc-list="listItems">
					<span arc-out="arc-var">listItem</span>

				</div>
				<div class="nestedContainer" arc-list="nestedObjects">
					<div arc-object="arc-var" arc-id="id">
						<span arc-out="id">nestedID</span>
						<span arc-out="name">nestedObjectName</span>
					</div>
				</div>
			</div>
		</div>

	</div>
</body>

<script>
	var applicationData = [{
			id: "89uon3af8anef",
			studentName: "Test Student",
			studentCode: "2017784",
			pdfIds: {
				one: "a039na",
				two: "9naen",
				three: "0a9na"
			},
			listItems: [1, 2, 3, 4],
			nestedObjects: [{
				id: 3938,
				name: "test"
			}, {
				id: 2983,
				name: "test2"
			}]
		},
		{
			id: "446246234",
			studentName: "Second Student",
			studentCode: "2017784",
			pdfIds: {
				one: "a039na",
				two: "9naen",
				three: "0a9na"
			},
			listItems: [1, 2, 3, 4],
			nestedObjects: [{
				id: 3938,
				name: "test"
			}, {
				id: 2983,
				name: "test2"
			}]
		}
	];

	var newData = [{
			id: "89uon3af8anef",
			studentName: "Test student - updated",
			studentCode: "2017784",
			pdfIds: {
				one: "a039na",
				two: "9naen",
				three: "0a9na"
			},
			listItems: [1, 2, 3, 4],
			nestedObjects: [{
				id: 3938,
				name: "test"
			}, {
				id: 2983,
				name: "test2"
			}]
		}, {
			id: "newId",
			studentName: "Third Student",
			studentCode: "2017784",
			pdfIds: {
				one: "a039na",
				two: "new pdf Id",
				three: "0a9na"
			},
			listItems: [1, 2, 3, 5, 6],
			nestedObjects: [{
				id: 3938,
				name: "test"
			}, {
				id: 1111,
				name: "VALUYE"
			}]
		},
		{
			id: "newId",
			studentName: "Second Student",
			studentCode: "2017784",
			pdfIds: {
				one: "a039na",
				two: "new pdf Id",
				three: "0a9na"
			},
			listItems: [1, 2, 3, 5, ],
			nestedObjects: [{
				id: 3938,
				name: "test"
			}, {
				id: 1111,
				name: "VALUYE"
			}]
		}
	];



	//alias Archetype as Arc if you know there is no conflicts
	Arc = Archetype;
	//Search the DOM for containers and propogate with data in any existing variables
	console.time('build');
	Archetype.build();
	console.timeEnd('build');


	setTimeout(function () {
		console.time();
		Archetype.update('apps', newData);
		setTimeout(function () {

			var newData = [{
				id: "89uon3af8anef",
				studentName: "Test student - updated",
				studentCode: "2017784",
				pdfIds: {
					one: "a039na",
					two: "9naen",
					three: "0a9na"
				},
				listItems: [1, 2, 3, 4],
				nestedObjects: [{
					id: 3938,
					name: "test"
				}, {
					id: 2983,
					name: "test2"
				}]
			}, {
				id: "newId",
				studentName: "Third Student",
				studentCode: "2017784",
				pdfIds: {
					one: "a039na",
					two: "new pdf Id",
					three: "0a9na"
				},
				listItems: [1, 2, 3, 5, 6],
				nestedObjects: [{
					id: 3938,
					name: "test"
				}, {
					id: 1111,
					name: "VALUYE"
				}]
			}, {
				id: "newId",
				studentName: "fourth student",
				studentCode: "2017784",
				pdfIds: {
					one: "a039na",
					two: "new pdf Id",
					three: "0a9na"
				},
				listItems: [1, 2, 3, 5, ],
				nestedObjects: [{
					id: 3938,
					name: "test"
				}, {
					id: 1111,
					name: "VALUYE"
				}]
			}, {
				id: "newId",
				studentName: "Second Student",
				studentCode: "2017784",
				pdfIds: {
					one: "a039na",
					two: "new pdf Id",
					three: "0a9na"
				},
				listItems: [1, 2, 3, 5, ],
				nestedObjects: [{
					id: 3938,
					name: "test"
				}, {
					id: 1111,
					name: "VALUYE"
				}]
			}]
			console.time();
			Archetype.update('apps', newData);
			console.timeEnd();
		}, 2000);
		console.timeEnd();
	}, 2000);
</script>
<script>
	Archetype.on = function (selector, event, func, onlyBindToArchetypes) {
		if (!onlyBindToArchetypes) {
			$(selector).on(event, func);
		}
		$.each(Archetype.data, function (index, value) {
			value.archetype.find(selector).addBack(selector).on(event, func);
		});
	}

	/*
	Archetype.on('.inbox-item', 'click', function () {
		console.log('clicked');
	});
	*/
</script>

</html>